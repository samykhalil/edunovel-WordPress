!function(u){var e,i,s,o,n,a,c,_;function t(){u(".product form.cart").each(function(){r(u(this))})}function r(t){var e;t.data("satt_script")||((e=new n(t)).initialize(),t.data("satt_script",e))}"undefined"!=typeof wcsatt_single_product_params&&(e=function(t){return new(Backbone.Model.extend({get_schemes_count:function(){var t,e=this.get("schemes"),i=0;for(t in e)e.hasOwnProperty(t)&&i++;return i},get_active_scheme_key:function(){return this.get("active_scheme_key")},get_last_active_scheme_key:function(){return this.previous("active_scheme_key")},set_active_scheme:function(t){this.set({active_scheme_key:"0"!==t&&t})},set_schemes:function(t){this.set({schemes:t})},is_active_scheme_prorated:function(){return this.get_scheme_prop(this.get_active_scheme_key(),"is_prorated")},was_last_active_scheme_prorated:function(){return this.get_scheme_prop(this.get_last_active_scheme_key(),"is_prorated")},get_scheme_prop:function(t,e){var i=this.get("schemes");return void 0===i[t]||void 0===i[t][e]?null:i[t][e]},initialize:function(){this.set({schemes:{},active_scheme_key:""})}}))(t)},i=function(t){return new(Backbone.View.extend({product:!1,$el_content:!1,$el_options:!1,$el_dropdown:!1,$el_prompt:!1,$el_option_items:!1,$el_option_inputs:!1,$el_button:!1,add_to_cart_button_text:!1,sign_up_button_text:!1,prompt_type:"",variation:!1,variation_options_render_location:"price_html",events:{"change select.wcsatt-options-product-dropdown":"dropdown_scheme_changed","change .wcsatt-options-prompt-action-input":"action_link_clicked","change .wcsatt-options-product-wrapper input":"active_scheme_changed",show_variation:"variation_found",reset_data:"reset_schemes"},action_link_clicked:function(t){var e=this.model,i="one-time"===this.get_prompt_val(),s=!1;if(e.get_active_scheme_key()){if(!i)return!1;e.set_active_scheme(!1),s=this.maybe_toggle_options()}else{if(i)return!1;i=this.$el_option_inputs.filter(":checked");"0"===i.val()?this.$el_option_inputs.filter('[value!="0"]').first().prop("checked",!0).trigger("change"):e.set_active_scheme(i.val()),s=this.maybe_toggle_options()}if(!s)return!1},dropdown_scheme_changed:function(t){var e=this.$el_dropdown.val();this.$el_option_inputs.filter('[value="'+e+'"]').prop("checked",!0).trigger("change")},active_scheme_changed:function(t){this.model.set_active_scheme(t.currentTarget.value)},variation_found:function(t,e){this.$el.hasClass("variations_form")&&(this.variation=e,"before_add_to_cart_button"===this.variation_options_render_location&&this.$el_content.replaceWith(e.satt_options_html),this.initialize({$el_content:this.$el.find(".wcsatt-options-wrapper")}),"before_add_to_cart_button"===this.variation_options_render_location&&1<this.$el_option_inputs.length&&this.$el_content.slideDown(200))},variation_selected:function(){return!1!==this.variation},reset_schemes:function(){this.$el.hasClass("variations_form")&&(this.variation=!1,"before_add_to_cart_button"===this.variation_options_render_location&&this.$el_content.slideUp(200),this.model.set_schemes({}),this.model.set_active_scheme(!1))},has_schemes:function(){return 0<this.$el_content.length},has_prompt:function(t){return 0<this.$el_prompt.length&&(!t||t===this.get_prompt_type())},has_dropdown:function(){return this.$el_dropdown&&0<this.$el_dropdown.length},get_prompt_type:function(){return this.$el_prompt.data("prompt_type")},get_prompt_val:function(){var t=!1;return this.has_prompt("radio")||this.has_prompt("checkbox")?(t=this.has_prompt("checkbox")&&!1===this.$el_prompt.find(".wcsatt-options-prompt-action-input").is(":checked")||this.has_prompt("radio")&&this.$el_prompt.find('.wcsatt-options-prompt-action-input[value="no"]').is(":checked")?!0:t)?"one-time":"subscribe":null},find_schemes:function(){var e={};return this.has_schemes()&&(this.$el_option_items=this.$el_options.find("li"),this.$el_option_inputs=this.$el_options.find("input"),this.$el_option_inputs.filter('[value!="0"]').each(function(){var t=u(this).data("custom_data");e[t.subscription_scheme.key]=t.subscription_scheme})),e},maybe_toggle_options:function(t){var e=this,i=(t=void 0!==t&&t)?0:200;if(!0===e.$el_content.data("animating"))return!1;if(e.$el_content.hasClass("closed")){if(e.model.get_schemes_count()<2)return!0;e.$el_content.removeClass("closed").addClass("open"),t?e.$el_options.show():(e.$el_content.data("animating",!0),setTimeout(function(){e.$el_options.slideDown({duration:i,queue:!1,always:function(){e.$el_content.data("animating",!1)}})},10))}else t?e.$el_options.hide():(e.$el_content.data("animating",!0),setTimeout(function(){e.$el_options.slideUp({duration:i,queue:!1,always:function(){e.$el_content.data("animating",!1)}})},10)),e.$el_content.removeClass("open").addClass("closed");return!0},schemes_visible:function(){return this.$el_content.hasClass("open")},update_button_text:function(){this.model.get_active_scheme_key()?!this.model.get_last_active_scheme_key()&&this.sign_up_button_text&&this.$el_button.text(this.sign_up_button_text):this.model.get_last_active_scheme_key()&&this.$el_button.text(this.add_to_cart_button_text)},initialize:function(t){var e;this.variation_options_render_location=t.$el_content.hasClass("wcsatt-options-wrapper--variation")?"before_add_to_cart_button":"price_html",this.$el_content=t.$el_content,this.$el_options=t.$el_content.find(".wcsatt-options-product-wrapper"),this.$el_prompt=t.$el_content.find(".wcsatt-options-product-prompt"),this.$el_dropdown=t.$el_content.find(".wcsatt-options-product-dropdown"),this.model.set_schemes(this.find_schemes()),t.product&&(this.product=t.product,this.$el_button=t.product.$form.find(".single_add_to_cart_button").last(),this.add_to_cart_button_text=this.$el_button.text(),this.listenTo(this.model,"change:active_scheme_key",this.update_button_text)),this.has_schemes()?(this.sign_up_button_text=this.$el_content.data("sign_up_text"),0<(t=this.$el_option_inputs.filter('[value="'+this.model.get_active_scheme_key()+'"]')).length?t.prop("checked",!0):this.$el_option_inputs.filter(":checked").trigger("change"),this.$el_option_inputs.length<=1&&this.$el_content.hide(),this.has_dropdown()&&(this.schemes_visible()?this.$el_options.show():this.$el_options.hide(),this.model.get_active_scheme_key()?(this.schemes_visible()||this.maybe_toggle_options(!0),this.has_prompt("checkbox")?this.$el_prompt.find(".wcsatt-options-prompt-action-input").prop("checked",!0):this.has_prompt("radio")&&this.$el_prompt.find('.wcsatt-options-prompt-action-input[value="yes"]').prop("checked",!0),this.$el_dropdown.val(this.model.get_active_scheme_key())):this.model.get_active_scheme_key()||(this.schemes_visible()&&this.maybe_toggle_options(!0),this.has_prompt("checkbox")?this.$el_prompt.find(".wcsatt-options-prompt-action-input").prop("checked",!1):this.has_prompt("radio")&&this.$el_prompt.find('.wcsatt-options-prompt-action-input[value="no"]').prop("checked",!0))),this.has_dropdown()&&(e=this,setTimeout(function(){(e.has_prompt("checkbox")?e.$el_prompt.find(".wcsatt-options-prompt-action-input"):e.$el_prompt.find(".wcsatt-options-prompt-action-input").filter(":checked")).trigger("change")},10))):this.variation_selected()?this.model.set_active_scheme(null):this.model.set_active_scheme(!1)}}))(t)},s=function(t){return new(Backbone.Model.extend({product:!1,xhr:!1,cached_responses:{},set_scheme_key:function(t){this.set({scheme_key:t})},get_scheme_key:function(){return this.get("scheme_key")},get_matching_subscriptions_html:function(){var e,i=this,t=this.product.schemes_model.get_active_scheme_key();this.xhr&&this.xhr.abort(),void 0!==this.cached_responses[t=!1===t?"0":t]?(i.set({html:this.cached_responses[t]}),i.trigger("matching_subscriptions_loaded")):(e={action:"wcsatt_load_subscriptions_matching_product",product_id:this.product.get_product_id(),subscription_scheme:t},this.xhr=u.post(wcsatt_single_product_params.wc_ajax_url.toString().replace("%%endpoint%%",e.action),e,function(t){"success"===t.result?(i.set({html:t.html}),i.cached_responses[e.subscription_scheme]=t.html):(i.set({html:!1}),i.attributes.scheme_key=!1),i.trigger("matching_subscriptions_loaded")}))},active_scheme_changed:function(){this.xhr&&this.xhr.abort()},initialize:function(t){this.product=t.product;this.set({scheme_key:"",html:!1}),this.listenTo(this.product.schemes_model,"change:active_scheme_key",this.active_scheme_changed),this.on("change:scheme_key",this.get_matching_subscriptions_html)}}))(t)},o=function(t){return new(Backbone.View.extend({$el_content:!1,product:!1,block_params:{message:null,fadeIn:0,fadeOut:0,overlayCSS:{background:"rgba( 255, 255, 255, 0 )",opacity:1}},events:{"click .wcsatt-add-to-subscription-action-input":"action_link_clicked"},action_link_clicked:function(){var t=this.model,e=this,i=!1;if(this.matching_subscriptions_visible()||this.model.get_scheme_key()===this.product.schemes_model.get_active_scheme_key()?i=this.toggle():(i=!0,this.$el.block(this.block_params),setTimeout(function(){t.set_scheme_key(e.product.schemes_model.get_active_scheme_key())},200)),!i)return!1},active_scheme_changed:function(){var t=this,e=!0;(e=!1!==this.product.schemes_model.get_active_scheme_key()&&!this.product.schemes_model.is_active_scheme_prorated()?e:!1)?(t.$el.hasClass("open")&&t.model.get_scheme_key()!==t.product.schemes_model.get_active_scheme_key()&&(t.$el.block(t.block_params),!1!==t.product.schemes_model.get_last_active_scheme_key()&&!this.product.schemes_model.was_last_active_scheme_prorated()||t.toggle(!0),setTimeout(function(){t.model.set_scheme_key(t.product.schemes_model.get_active_scheme_key())},250)),setTimeout(function(){t.$el.slideDown(200).removeClass("inactive").addClass("active")},50)):this.$el.slideUp(200).removeClass("active").addClass("inactive")},add_to_subscription_button_clicked:function(t){t=t.data.view.product.$form.find(".single_add_to_cart_button").last();if(t.hasClass("disabled"))return t.click(),!1},toggle:function(t){var e=this,i=(t=void 0!==t&&t)?0:200;return!0!==e.$el.data("animating")&&(e.$el.hasClass("closed")?(setTimeout(function(){e.$el_content.slideDown({duration:i,queue:!1,always:function(){e.$el.data("animating",!1)}})},10),e.$el.removeClass("closed").addClass("open")):(setTimeout(function(){e.$el_content.slideUp({duration:i,queue:!1,always:function(){e.$el.data("animating",!1)}})},10),e.$el.removeClass("open").addClass("closed")),e.$el.data("animating",!0),!0)},matching_subscriptions_visible:function(){return this.$el_content.is(":visible")},matching_subscriptions_loaded:function(){this.render()},render:function(){var t=this.model.get("html");this.$el.unblock(),!1===t?(window.alert(wcsatt_single_product_params.i18n_subs_load_error),this.matching_subscriptions_visible()&&this.toggle(),this.$el.find("input.wcsatt-add-to-subscription-action-input").prop("checked",!1)):(this.$el_content.html(t),this.matching_subscriptions_visible()||this.toggle())},initialize:function(t){this.product=t.product,this.$el_content=t.$el_content,this.listenTo(this.model,"matching_subscriptions_loaded",this.matching_subscriptions_loaded),this.listenTo(this.product.schemes_model,"change:active_scheme_key",this.active_scheme_changed),this.$el_content.on("click",".wcsatt-add-to-subscription-button",{view:this},this.add_to_subscription_button_clicked)}}))(t)},n=function(t){this.$form=t,this.schemes_model=!1,this.schemes_view=!1,this.matching_subscriptions_model=!1,this.matching_subscriptions_view=!1,this.initialize=function(){this.schemes_model=new e({product:this}),this.matching_subscriptions_model=new s({product:this}),this.schemes_view=new i({product:this,model:this.schemes_model,el:t,$el_content:t.find(".wcsatt-options-wrapper")}),this.matching_subscriptions_view=new o({product:this,model:this.matching_subscriptions_model,el:t.find(".wcsatt-add-to-subscription-wrapper"),$el_content:t.find(".wcsatt-add-to-subscription-options")}),-1!=window.location.href.indexOf("switch-subscription")&&-1!=window.location.href.indexOf("item")&&t.prop("action",""),t.on("submit",{view:this.schemes_view},this.form_submitted),this.pao=new a(this)},this.get_product_id=function(){return t.find(".wcsatt-add-to-subscription-wrapper").data("product_id")},this.form_submitted=function(t){t=t.data.view;"one-time"===t.get_prompt_val()&&t.$el_option_inputs.filter('[value="0"]').prop("checked",!0)},this.round_number=function(t,e){e=Math.pow(10,e);return Math.round(t*e)/e}},a=function(i){var s=this;this.$addons_totals=!1,this.$discount_addons_data=i.$form.find(".wcsatt-pao-data"),this.initialize=function(){var t,e;i.$form.hasClass("bundle_form")||i.$form.hasClass("composite_form")||0<(t=i.$form.find("#product-addons-total")).length&&1==t.data("show-sub-total")&&(e="yes"===this.$discount_addons_data.data("discount_addons"),this.$addons_totals=t,e?(i.schemes_view.$el_content.insertAfter(t),t.addClass("subscription-details-hidden")):i.schemes_view.$el_content.insertBefore(i.$form.find(".wc-pao-addon-container").first()),e||(i.schemes_model.on("change:active_scheme_key",this.active_scheme_changed),i.$form.on("show_variation",this.variation_changed)),i.schemes_model.get_active_scheme_key()&&this.active_scheme_changed())},this.active_scheme_changed=function(){var t=!1===i.schemes_model.get_active_scheme_key()?"0":i.schemes_model.get_active_scheme_key(),t=i.schemes_view.$el_options.find('input[value="'+t+'"]').data("custom_data"),e=!!t&&t.display_price,t=!!t&&t.raw_price;!1!==e&&!1!==t&&(s.$addons_totals.data("price",e),s.$addons_totals.data("raw-price",t),i.$form.trigger("woocommerce-product-addons-update"))},this.variation_changed=function(){s.active_scheme_changed()},this.initialize()},c=function(i){var p=this,h=i.$bundle_form.data("satt_script");this.initialize_ui=function(){0<h.schemes_view.$el_content.length&&(!1!==i.$addons_totals?i.$addons_totals:i.$bundle_price).after(h.schemes_view.$el_content)},this.initialize_schemes=function(){i.satt_schemes=[],i.satt_scheme_one_time=!1;var t=h.schemes_view.$el_option_items.filter(".one-time-option");t.length&&(i.satt_scheme_one_time={$el:t,data:t.find("input").data("custom_data")}),h.schemes_view.$el_option_items.filter(".subscription-option").each(function(){var t=u(this),e=t.find("input").data("custom_data");i.satt_schemes.push({$el:t,data:e})})},this.integrate=function(){h.schemes_view.has_schemes()&&(p.initialize_ui(),p.initialize_schemes(),0<i.satt_schemes.length&&(i.$bundle_data.on("woocommerce-product-bundle-updated-totals",p.update_subscription_totals),"no"!==i.price_data.hide_total_on_validation_fail&&i.$bundle_data.on("woocommerce-product-bundle-validation-status-changed",p.maybe_hide_subscription_options)))},this.has_single_forced_susbcription=function(){return 1===i.satt_schemes.length&&!1===i.satt_scheme_one_time},this.maybe_hide_subscription_options=function(){i.passes_validation()?p.has_single_forced_susbcription()||h.schemes_view.$el_content.slideDown(200):h.schemes_view.$el_content.slideUp(200)},this.update_subscription_totals=function(t,_){var r,d,e,i;!_.passes_validation()&&"no"!==_.price_data.hide_total_on_validation_fail||(r=_.get_price_html(),d=u(r).html(),!1!==_.satt_scheme_one_time&&(i=_.satt_scheme_one_time.$el.find(".price.one-time-price"),e=_.satt_scheme_one_time.data.option_details_html.replace(/%p/g,d),i.length&&i.html(e).find("span.total").remove(),(h.schemes_view.has_prompt("radio")||h.schemes_view.has_prompt("checkbox"))&&0<(i=h.schemes_view.$el_prompt.find('.wcsatt-options-prompt-action-input[value="no"]').closest(".wcsatt-options-prompt-label").find(".wcsatt-options-prompt-action")).find(".price").length&&i.html(_.satt_scheme_one_time.data.prompt_details_html.replace(/%p/g,d)).find("span.total").remove()),p.has_single_forced_susbcription()?_.$bundle_price.find(".price").html(_.satt_schemes[0].data.option_details_html.replace(/%p/g,d)):u.each(_.satt_schemes,function(t,i){var s,e,o,n,a,c;(i.data.option_has_price||h.schemes_view.has_prompt("radio")||h.schemes_view.has_prompt("checkbox"))&&(s=u.extend(!0,{},_.price_data),e=r,n=d,i.data.subscription_scheme.has_price_filter&&("inherit"===i.data.subscription_scheme.pricing_mode&&0<i.data.subscription_scheme.discount?(u.each(_.bundled_items,function(t,e){e=e.bundled_item_id;i.data.discount_from_regular?s.prices[e]=s.regular_prices[e]*(1-i.data.subscription_scheme.discount/100):(s.regular_prices[e]=s.prices[e],s.prices[e]=s.prices[e]*(1-i.data.subscription_scheme.discount/100)),s.addons_prices[e]=s.addons_prices[e]*(1-i.data.subscription_scheme.discount/100)}),i.data.discount_from_regular?s.base_price=s.base_regular_price*(1-i.data.subscription_scheme.discount/100):s.base_price=s.base_price*(1-i.data.subscription_scheme.discount/100),o=_.get_addons_raw_price(),s.addons_regular_price=_.has_addons()&&"yes"===h.pao.$discount_addons_data.data("discount_addons")?o:0,s.addons_price=_.has_addons()&&"yes"===h.pao.$discount_addons_data.data("discount_addons")?o*(1-i.data.subscription_scheme.discount/100):0):"override"===i.data.subscription_scheme.pricing_mode&&(s.base_regular_price=Number(i.data.subscription_scheme.regular_price),s.base_price=Number(i.data.subscription_scheme.price)),s=_.calculate_subtotals(!1,s),s=_.calculate_totals(s),e=_.get_price_html(s),n=u(e).html()),o=i.$el.find(".subscription-price"),a=i.data.option_details_html.replace(/%p/g,n),i.data.subscription_scheme.is_base&&(h.schemes_view.has_prompt("radio")||h.schemes_view.has_prompt("checkbox"))&&0<(c=h.schemes_view.$el_prompt.find('.wcsatt-options-prompt-action-input[value="yes"]').closest(".wcsatt-options-prompt-label").find(".wcsatt-options-prompt-action")).find(".subscription-price").length&&c.html(i.data.prompt_details_html.replace(/%p/g,n)).find("span.total").remove(),i.data.option_has_price&&(o.html(a).find("span.total").remove(),h.schemes_view.has_dropdown()&&(c=wc_pb_price_format(s.totals.price,!0),n="",c=i.data.dropdown_format.replace("%p",c),i.data.subscription_scheme.has_price_filter&&("inherit"===i.data.subscription_scheme.pricing_mode&&0<i.data.subscription_scheme.discount?(n=h.round_number(i.data.subscription_scheme.discount,i.data.dropdown_discount_decimals),c=i.data.dropdown_discounted_format.replace("%d",n).replace("%p",c)):s.totals.regular_price>s.totals.price&&(a=wc_pb_price_format(s.totals.regular_price,!0),c=i.data.dropdown_sale_format.replace("%r",a).replace("%p",c))),h.schemes_view.$el_dropdown.find("option[value="+i.data.subscription_scheme.key+"]").text(c))),o.trigger("wcsatt-updated-bundle-price",[e,i,_,p]))}))},h&&this.integrate()},_=function(h){var l=this,m=h.$composite_form.data("satt_script");this.initialize_ui=function(){0<m.schemes_view.$el_content.length&&(!1!==h.composite_price_view.$addons_totals?h.composite_price_view.$addons_totals:h.$composite_price).after(m.schemes_view.$el_content)},this.initialize_schemes=function(){h.satt_schemes=[],h.satt_scheme_one_time=!1;var t=m.schemes_view.$el_option_items.filter(".one-time-option");t.length&&(h.satt_scheme_one_time={$el:t,data:t.find("input").data("custom_data")}),m.schemes_view.$el_option_items.filter(".subscription-option").each(function(){var t=u(this),e=t.find("input").data("custom_data");h.satt_schemes.push({$el:t,data:e})})},this.integrate=function(){m.schemes_view.has_schemes()&&(l.initialize_schemes(),h.actions.add_action("initialize_composite",function(){l.initialize_ui(),0<h.satt_schemes.length&&(l.has_single_forced_susbcription()?h.filters.add_filter("composite_price_html",l.filter_price_html,10,l):(h.actions.add_action("composite_totals_changed",l.update_subscription_totals,101,l),"no"!==h.settings.hide_total_on_validation_fail&&(h.actions.add_action("composite_validation_status_changed",l.maybe_hide_subscription_options,101,l),h.actions.add_action("composite_initialized",l.maybe_hide_subscription_options,101,l))))},51,this))},this.has_single_forced_susbcription=function(){return 1===h.satt_schemes.length&&!1===h.satt_scheme_one_time},this.maybe_hide_subscription_options=function(){"pass"===h.api.get_composite_validation_status()?l.has_single_forced_susbcription()||m.schemes_view.$el_content.slideDown(200):m.schemes_view.$el_content.slideUp(200)},this.filter_price_html=function(t,e,i){var s=u(t).html();return t='<p class="price">'+h.satt_schemes[0].data.option_details_html.replace(/%p/g,s)+"</p>"},this.update_subscription_totals=function(){var r,d,p,t,e;"pass"!==h.api.get_composite_validation_status()&&"no"!==h.settings.hide_total_on_validation_fail||(r=h.composite_price_view.get_price_html(),d=h.data_model.calculate_totals(),p=u(r).html(),!1!==h.satt_scheme_one_time&&(e=h.satt_scheme_one_time.$el.find(".price.one-time-price"),t=h.satt_scheme_one_time.data.option_details_html.replace(/%p/g,p),e.length&&e.html(t).find("span.total").remove(),(m.schemes_view.has_prompt("radio")||m.schemes_view.has_prompt("checkbox"))&&0<(e=m.schemes_view.$el_prompt.find('.wcsatt-options-prompt-action-input[value="no"]').closest(".wcsatt-options-prompt-label").find(".wcsatt-options-prompt-action")).find(".price").length&&e.html(h.satt_scheme_one_time.data.prompt_details_html.replace(/%p/g,p)).find("span.total").remove()),u.each(h.satt_schemes,function(t,i){var s,e,o,n,a,c,_;(i.data.option_has_price||m.schemes_view.has_prompt("radio")||m.schemes_view.has_prompt("checkbox"))&&(s=u.extend(!0,{},h.data_model.price_data),e=r,a=p,o=d,i.data.subscription_scheme.has_price_filter&&(l.maybe_add_bundle_totals_filters(i),"inherit"===i.data.subscription_scheme.pricing_mode&&0<i.data.subscription_scheme.discount?(u.each(h.get_components(),function(t,e){e=e.component_id;i.data.discount_from_regular?s.prices[e]=s.regular_prices[e]*(1-i.data.subscription_scheme.discount/100):(s.regular_prices[e]=s.prices[e],s.prices[e]=s.prices[e]*(1-i.data.subscription_scheme.discount/100)),s.addons_prices[e]=s.addons_prices[e]*(1-i.data.subscription_scheme.discount/100)}),i.data.discount_from_regular?s.base_price=s.base_regular_price*(1-i.data.subscription_scheme.discount/100):s.base_price=s.base_price*(1-i.data.subscription_scheme.discount/100),n=h.composite_price_view.get_addons_raw_price(),s.addons_regular_price=h.composite_price_view.has_addons()&&"yes"===m.pao.$discount_addons_data.data("discount_addons")?n:0,s.addons_price=h.composite_price_view.has_addons()&&"yes"===m.pao.$discount_addons_data.data("discount_addons")?n*(1-i.data.subscription_scheme.discount/100):0):"override"===i.data.subscription_scheme.pricing_mode&&(s.base_regular_price=Number(i.data.subscription_scheme.regular_price),s.base_price=Number(i.data.subscription_scheme.price)),s=h.data_model.calculate_subtotals(!1,s),l.maybe_remove_bundle_totals_filters(i),o=h.data_model.calculate_totals(s),s.totals=o,e=h.composite_price_view.get_price_html(s),a=u(e).html()),n=i.$el.find(".subscription-price"),c=i.data.option_details_html.replace(/%p/g,a),i.data.subscription_scheme.is_base&&(m.schemes_view.has_prompt("radio")||m.schemes_view.has_prompt("checkbox"))&&0<(_=m.schemes_view.$el_prompt.find('.wcsatt-options-prompt-action-input[value="yes"]').closest(".wcsatt-options-prompt-label").find(".wcsatt-options-prompt-action")).find(".subscription-price").length&&_.html(i.data.prompt_details_html.replace(/%p/g,a)).find("span.total").remove(),i.data.option_has_price&&(n.html(c).find("span.total").remove(),m.schemes_view.has_dropdown()&&(_=wc_cp_price_format(o.price,!0),a="",_=i.data.dropdown_format.replace("%p",_),i.data.subscription_scheme.has_price_filter&&("inherit"===i.data.subscription_scheme.pricing_mode&&0<i.data.subscription_scheme.discount?(a=m.round_number(i.data.subscription_scheme.discount,i.data.dropdown_discount_decimals),_=i.data.dropdown_discounted_format.replace("%d",a).replace("%p",_)):s.totals.regular_price>s.totals.price&&(c=wc_cp_price_format(s.totals.regular_price,!0),_=i.data.dropdown_sale_format.replace("%r",c).replace("%p",_))),m.schemes_view.$el_dropdown.find("option[value="+i.data.subscription_scheme.key+"]").text(_))),n.trigger("wcsatt-updated-composite-price",[e,i,h,l]))}))},this.maybe_add_bundle_totals_filters=function(i){"inherit"===i.data.subscription_scheme.pricing_mode&&0<i.data.subscription_scheme.discount&&u.each(h.get_components(),function(t,e){"bundle"===e.get_selected_product_type()&&(e=e.get_bundle_script())&&(e.satt_scheme=i,e.filters.add_filter("bundle_totals",l.filter_bundle_totals,10,l))})},this.maybe_remove_bundle_totals_filters=function(t){"inherit"===t.data.subscription_scheme.pricing_mode&&0<t.data.subscription_scheme.discount&&u.each(h.get_components(),function(t,e){"bundle"===e.get_selected_product_type()&&(e=e.get_bundle_script())&&(e.satt_scheme=!1,e.filters.remove_filter("bundle_totals",l.filter_bundle_totals))})},this.filter_bundle_totals=function(t,e,i,s){if(!i.satt_scheme)return t;var o=i.satt_scheme.data,n=o.subscription_scheme.discount,a=u.extend(!0,{},e);return s=void 0===s?i.composite_data.component.get_selected_quantity():s,u.each(i.bundled_items,function(t,e){o.discount_from_regular?a.prices[e.bundled_item_id]=a.regular_prices[e.bundled_item_id]*(1-n/100):a.prices[e.bundled_item_id]=a.prices[e.bundled_item_id]*(1-n/100)}),a.base_price&&(o.discount_from_regular?a.base_price=Number(a.base_regular_price)*(1-n/100):a.base_price=Number(a.base_price)*(1-n/100)),i.satt_scheme=!1,a=i.calculate_subtotals(!1,a,s),t=(a=i.calculate_totals(a)).totals},this.integrate()},t(),u(".bundle_form .bundle_data").each(function(){u(this).on("woocommerce-product-bundle-initializing",function(t,e){e.is_composited()||new c(e)})}),u(".composite_form .composite_data").each(function(){u(this).on("wc-composite-initializing",function(t,e){new _(e)})}),u(document.body).on("wcsatt-initialize",function(){t()}),u.fn.wcsatt_initialize=function(){u(this).find(".product form.cart").each(function(){r(u(this))})})}(jQuery);